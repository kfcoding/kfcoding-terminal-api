<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<input id="input"> </input>
<button onclick="send()">send</button>
</body>
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
<script>
    var input;
    var sock;
    $(document).ready(function () {
        input = document.getElementById("output");
        getId();
    });

    function getId() {
        $.ajax({
            "url": "http://api.kfcoding.com/cloudware/startContainer?imageName=nginx&type=1",
            //"url": "http://terminal.wss.kfcoding.com/api/v1/pod/kfcoding-alpha/shell-demo/shell/nginx",
            "method": "GET"
        }).done(function (response) {
            console.log(response.result.WsAddr);
            connectWS(response.result.WsAddr);
        });
    }

    function send() {
        var str = document.getElementById('input').value + "\r";
        sock.send(JSON.stringify({'Op': 'stdin', 'Data': str}));
    }

    function connectWS(wsaddr) {
//         response.substring(1, response.length - 1);
        var token = wsaddr.split("?")[1];

        var newwsaddr = "http://120.132.94.141:9090/api/sockjs?" + token;

        console.log(newwsaddr);

        sock = new SockJS(newwsaddr);
        sock.onopen = function () {
            console.log('open');
            sock.send(JSON.stringify({'Op': 'bind', 'SessionID': token}));
            sock.send(JSON.stringify({'Op': 'resize', 'Cols': 154, 'Rows': 39}));
        };

        sock.onmessage = function (evt) {
            console.log(evt.data);
//            let msg = JSON.parse(evt.data);
            // switch (msg['Op']) {
            //     case 'stdout':
            //         console.log(msg['Data']);
            //         break;
            //     case 'toast':
            //         console.log(msg['Data']);
            //         break;
            //     default:
            //         console.error('Unexpected message type:', msg);
            // }
        };

        sock.onclose = function () {
            console.log('close');
        };
    }

</script>
</html>

